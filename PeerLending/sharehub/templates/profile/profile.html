{% extends "base.html" %}
{% load static %}

{% block title %}Profile - ShareHub{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
<link rel="stylesheet" href="{% static 'css/add-item-modal.css' %}">
{% endblock %}

{% block content %}
<main class="profile-page">
  <div class="profile-left">
    <div class="profile-card" style="text-align:center">
      <div class="header-avatar profile-avatar">
        <img
          src="{% if user_info.profile_picture %}{{ user_info.profile_picture }}{% else %}{% static 'images/user.png' %}{% endif %}"
          alt="Profile Picture"
          data-fallback="{% static 'images/user.png' %}"
          onerror="this.onerror=null; this.src=this.dataset.fallback"
        />
      </div>

      <h3>{{ user_info.first_name }} {{ user_info.last_name }}</h3>
      <p>{{ user_info.email }}</p>
      <span class="role-badge">Verified Student</span>
      <span class="student-id">Student ID<br>{{ user_info.student_id }}</span>
    </div>

    <div class="card borrow-stats-card">
      <h3>Borrowing Statistics</h3>

      <div class="stats-grid">
        <div class="stat">
          <div class="stat-value">{{ borrow_stats.total_borrowed|default:0 }}</div>
          <div class="stat-label">Total Borrowed</div>
        </div>
        <div class="stat">
          <div class="stat-value">{{ borrow_stats.currently_borrowed|default:0 }}</div>
          <div class="stat-label">Currently Borrowed</div>
        </div>
        <div class="stat">
          <div class="stat-value">{{ borrow_stats.total_returned|default:0 }}</div>
          <div class="stat-label">Returned</div>
        </div>
        <div class="stat">
          <div class="stat-value">{{ borrow_stats.overdue|default:0 }}</div>
          <div class="stat-label">Overdue</div>
        </div>
      </div>
    </div>
  </div>

  <div class="profile-right">
    <div class="card">
      <div class="profile-header">
        <div>
          <h3>Profile Information</h3>
          <p>Your personal and academic details</p>
        </div>
        <button type="button" class="action-btn" id="editProfileBtn" aria-label="Edit profile">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Edit Profile
        </button>
      </div>

      <div class="info-section">
        <h4>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          Personal Information
        </h4>
        <div class="info-grid">
          <div class="info-item"><strong><img src="{% static 'images/user.png' %}" class="field-icon"> Full Name</strong><span>{{ user_info.first_name }} {{ user_info.last_name }}</span></div>
          <div class="info-item"><strong><img src="{% static 'images/email.png' %}" class="field-icon"> Email</strong><span>{{ user_info.email }}</span></div>
          <div class="info-item"><strong><img src="{% static 'images/calendar.png' %}" class="field-icon"> Birth Date</strong><span>{{ user_info.birthday|default:"N/A" }}</span></div>
          <div class="info-item"><strong><img src="{% static 'images/phone.png' %}" class="field-icon"> Phone</strong><span>{{ user_info.phone_number|default:"N/A" }}</span></div>
        </div>
      </div>

      <div class="info-section">
        <h4>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
            <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
          </svg>
          Academic Information
        </h4>
        <div class="info-grid">
          <div class="info-item"><strong><img src="{% static 'images/department.png' %}" class="field-icon"> Department</strong><span>{{ user_info.college_dept|default:"N/A" }}</span></div>
          <div class="info-item"><strong><img src="{% static 'images/course.png' %}" class="field-icon"> Course</strong><span>{{ user_info.course|default:"N/A" }}</span></div>
          <div class="info-item"><strong><img src="{% static 'images/calendar.png' %}" class="field-icon"> Year</strong><span>{{ user_info.year_level|default:"N/A" }}</span></div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}

{% block extra_scripts %}
<script>
  // go to edit profile page
  document.addEventListener('DOMContentLoaded', function () {
    const btn = document.getElementById('editProfileBtn');
    if (btn) btn.addEventListener('click', () => { window.location.href = "{% url 'edit_profile' %}"; });
  });
</script>
{% endblock %}
