{# templates/admin/admin_reports.html #}
{% extends "admin/admin_base.html" %}
{% load static %}
{% block title %}Reported Issues Â· Admin{% endblock %}

{% block content %}
<div class="reports-container">
  <!-- Page Header -->
  <div class="reports-header">
    <div class="header-content">
      <h1 class="page-title">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" class="title-icon">
          <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Reported Issues
      </h1>
      <p class="page-subtitle">Monitor and resolve reported problems in the system</p>
    </div>
    <div class="header-actions">
      <div class="reports-summary">
        <span class="total-reports">{{ reports|length }}</span>
        <span class="summary-label">Total Reports</span>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="reports-stats-grid">
    <div class="stat-card open-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value" id="open-count">{{ counts.open|default:0 }}</div>
        <div class="stat-label">Open Issues</div>
        <div class="stat-trend">Requiring attention</div>
      </div>
    </div>

    <div class="stat-card progress-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value" id="progress-count">{{ counts.in_progress|default:0 }}</div>
        <div class="stat-label">In Progress</div>
        <div class="stat-trend">Being addressed</div>
      </div>
    </div>

    <div class="stat-card resolved-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value" id="resolved-count">{{ counts.resolved|default:0 }}</div>
        <div class="stat-label">Resolved</div>
        <div class="stat-trend">Successfully closed</div>
      </div>
    </div>

    <div class="stat-card trend-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M7 14l4-4 4 4 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M17 8v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ reports|length }}</div>
        <div class="stat-label">This Month</div>
        <div class="stat-trend">Total reports</div>
      </div>
    </div>
  </div>

  <!-- Reports Section -->
  <div class="reports-section">
    <div class="section-header">
      <div class="section-title">
        <h3>Issue Reports</h3>
        <div class="section-filters">
          <div class="filter-group">
            <label>Status:</label>
            <select class="filter-select" id="status-filter">
              <option value="all">All Status</option>
              <option value="open">Open</option>
              <option value="in_progress">In Progress</option>
              <option value="resolved">Resolved</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Type:</label>
            <select class="filter-select" id="type-filter">
              <option value="all">All Types</option>
              <option value="item">Item Issues</option>
              <option value="request">Request Issues</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
      </div>
      <p>Manage and track all reported system issues</p>
    </div>

    {% if reports %}
    <div class="reports-grid">
      {% for r in reports %}
      {% with status=r.status|default:"open" %}
      <div class="report-card" data-report-id="{{ r.report_id }}" data-status="{{ status }}">
        <div class="report-header">
          <div class="report-meta">
            <span class="report-date">{{ r.created_at }}</span>
            <span class="report-id">#{{ forloop.counter }}</span>
          </div>
          <div class="report-type">
            {% if r.item_id %}
              <span class="type-badge item-type">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Item Issue
              </span>
            {% elif r.request_id %}
              <span class="type-badge request-type">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Request Issue
              </span>
            {% else %}
              <span class="type-badge other-type">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                General Issue
              </span>
            {% endif %}
          </div>
        </div>

        <div class="report-content">
          <h4 class="report-title">{{ r.title }}</h4>
          <p class="report-description">{{ r.description|truncatewords:25 }}</p>
          
          <div class="report-details">
            <div class="detail-item">
              <span class="detail-label">Reference:</span>
              <span class="detail-value">
                {% if r.item_id %}
                  Item #{{ r.item_id }}
                {% elif r.request_id %}
                  Request #{{ r.request_id }}
                {% else %}
                  N/A
                {% endif %}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Reported by:</span>
              <span class="detail-value">{{ r.reported_by_email|default:r.reported_by }}</span>
            </div>
          </div>
        </div>

        <div class="report-footer">
          <div class="status-indicator">
            {% if status == "in progress" or status == "in_progress" %}
              <span class="status-badge progress">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                In Progress
              </span>
            {% elif status == "resolved" %}
              <span class="status-badge resolved">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Resolved
              </span>
            {% else %}
              <span class="status-badge open">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Open
              </span>
            {% endif %}
          </div>

          <div class="report-actions">
            {% if status == "open" %}
              <button class="action-btn progress-btn" data-report-id="{{ r.report_id }}" data-action="in_progress">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Start Progress
              </button>
            {% elif status == "in_progress" or status == "in progress" %}
              <button class="action-btn resolve-btn" data-report-id="{{ r.report_id }}" data-action="resolved">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Mark Resolved
              </button>
            {% endif %}
            
            <button class="action-btn view-btn" data-report-id="{{ r.report_id }}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
              View Details
            </button>
          </div>
        </div>
      </div>
      {% endwith %}
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <div class="empty-icon">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3>No Reported Issues</h3>
      <p>All clear! There are no reported issues at the moment. Check back later for new reports.</p>
    </div>
    {% endif %}
  </div>
</div>

<!-- Report Details Modal -->
<div id="report-details-modal" class="modal hidden">
  <div class="modal-backdrop"></div>
  <div class="modal-panel">
    <header class="modal-header">
      <h3>Report Details</h3>
      <button class="modal-close">&times;</button>
    </header>
    <div class="modal-body">
      <div class="report-detail-content">
        <!-- Content will be populated by JavaScript -->
      </div>
    </div>
    <footer class="modal-footer">
      <button class="btn btn-secondary close-modal">Close</button>
    </footer>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ reports|json_script:"reports-data" }}

<script>
(function () {
  const UPDATE_URL = "{% url 'admin_update_report_status' %}";
  
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
  }

  function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
      <span>${message}</span>
      <button class="close-notification">&times;</button>
    `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => notification.classList.add('show'), 100);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => notification.remove(), 300);
    }, 5000);
    
    // Close on click
    notification.querySelector('.close-notification').addEventListener('click', () => {
      notification.classList.remove('show');
      setTimeout(() => notification.remove(), 300);
    });
  }

  function recalcCounts() {
    let open = 0, progress = 0, resolved = 0;
    document.querySelectorAll('.report-card').forEach(card => {
      const status = card.getAttribute('data-status');
      if (status === 'open') open++;
      else if (status === 'in_progress' || status === 'in progress') progress++;
      else if (status === 'resolved') resolved++;
    });
    
    document.getElementById('open-count').textContent = open;
    document.getElementById('progress-count').textContent = progress;
    document.getElementById('resolved-count').textContent = resolved;
  }

  async function postJson(url, body) {
    const csrftoken = getCookie('csrftoken');
    try {
      const resp = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
        body: JSON.stringify(body),
        credentials: 'same-origin'
      });
      const data = await resp.json();
      return { ok: resp.ok, data };
    } catch (e) { 
      console.error('Network error', e); 
      return { ok: false, data: null, error: e }; 
    }
  }

  function updateReportStatus(card, newStatus) {
    const safeStatus = String(newStatus).replace(/\s+/g, '_').toLowerCase();
    card.setAttribute('data-status', safeStatus);
    
    const statusBadge = card.querySelector('.status-badge');
    const progressBtn = card.querySelector('.progress-btn');
    const resolveBtn = card.querySelector('.resolve-btn');
    
    // Update status badge
    statusBadge.className = `status-badge ${safeStatus}`;
    if (safeStatus === 'in_progress') {
      statusBadge.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
          <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        In Progress
      `;
    } else if (safeStatus === 'resolved') {
      statusBadge.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
          <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Resolved
      `;
    } else {
      statusBadge.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
          <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Open
      `;
    }
    
    // Update buttons
    if (safeStatus === 'open') {
      if (progressBtn) progressBtn.style.display = 'flex';
      if (resolveBtn) resolveBtn.style.display = 'none';
    } else if (safeStatus === 'in_progress') {
      if (progressBtn) progressBtn.style.display = 'none';
      if (resolveBtn) resolveBtn.style.display = 'flex';
    } else {
      if (progressBtn) progressBtn.style.display = 'none';
      if (resolveBtn) resolveBtn.style.display = 'none';
    }
    
    // Add success animation
    card.style.animation = 'pulseSuccess 0.6s ease';
    setTimeout(() => card.style.animation = '', 600);
  }

  // Event listeners
  document.addEventListener('DOMContentLoaded', function () {
    // Status update buttons
    document.addEventListener('click', async function (ev) {
      const btn = ev.target.closest('.progress-btn, .resolve-btn');
      if (!btn) return;
      
      ev.preventDefault();
      const reportId = btn.getAttribute('data-report-id');
      const action = btn.getAttribute('data-action');
      const card = btn.closest('.report-card');
      
      if (!reportId || !action) return;
      
      // Show loading state
      btn.disabled = true;
      btn.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="loading-spinner">
          <path d="M12 2v4m0 12v4m8-10h4M2 12h4m13.364-5.636l2.828 2.828M5.636 18.364l2.828 2.828M18.364 18.364l2.828-2.828M5.636 5.636l2.828-2.828" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Updating...
      `;
      
      const resp = await postJson(UPDATE_URL, { report_id: reportId, status: action });
      
      if (!resp.ok || !resp.data) {
        showNotification('Network error while updating status', 'error');
        btn.disabled = false;
        btn.innerHTML = action === 'in_progress' ? 
          '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Start Progress' :
          '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg> Mark Resolved';
        return;
      }
      
      if (resp.data.success) {
        updateReportStatus(card, action);
        recalcCounts();
        showNotification('Report status updated successfully', 'success');
      } else {
        showNotification('Failed to update report: ' + (resp.data.message || resp.data.error || 'Unknown error'), 'error');
        btn.disabled = false;
        btn.innerHTML = action === 'in_progress' ? 
          '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Start Progress' :
          '<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg> Mark Resolved';
      }
    });

    // Filter functionality
    const statusFilter = document.getElementById('status-filter');
    const typeFilter = document.getElementById('type-filter');
    
    if (statusFilter && typeFilter) {
      const applyFilters = () => {
        const statusValue = statusFilter.value;
        const typeValue = typeFilter.value;
        
        document.querySelectorAll('.report-card').forEach(card => {
          const cardStatus = card.getAttribute('data-status');
          const cardType = card.querySelector('.type-badge').className.includes('item-type') ? 'item' : 
                          card.querySelector('.type-badge').className.includes('request-type') ? 'request' : 'other';
          
          const statusMatch = statusValue === 'all' || cardStatus === statusValue;
          const typeMatch = typeValue === 'all' || cardType === typeValue;
          
          card.style.display = statusMatch && typeMatch ? 'block' : 'none';
        });
      };
      
      statusFilter.addEventListener('change', applyFilters);
      typeFilter.addEventListener('change', applyFilters);
    }

    // View details buttons
    document.querySelectorAll('.view-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // Implement view details functionality here
        showNotification('View details feature coming soon', 'info');
      });
    });

    // Modal functionality
    const modal = document.getElementById('report-details-modal');
    const closeModal = () => {
      modal.classList.add('hidden');
    };
    
    document.querySelectorAll('.modal-close, .close-modal').forEach(btn => {
      btn.addEventListener('click', closeModal);
    });
    
    document.querySelector('.modal-backdrop').addEventListener('click', closeModal);

    // Add hover effects
    document.querySelectorAll('.report-card').forEach(card => {
      card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-4px)';
      });
      
      card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
      });
    });

    // Initialize counts
    recalcCounts();
  });
})();
</script>

<style>
/* Reports Specific Styles */
.reports-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
}

.reports-header {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid var(--color-border-light);
}

.header-content {
  flex: 1;
}

.page-title {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: var(--font-size-3xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 8px;
}

.title-icon {
  color: var(--color-warning);
}

.page-subtitle {
  font-size: var(--font-size-lg);
  color: var(--color-text-secondary);
  margin: 0;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 20px;
}

.reports-summary {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  background: var(--color-surface);
  padding: 16px 24px;
  border-radius: 16px;
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-sm);
}

.total-reports {
  font-size: 28px;
  font-weight: 800;
  color: var(--color-primary);
}

.summary-label {
  font-size: 13px;
  color: var(--color-text-secondary);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Statistics Grid */
.reports-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.stat-card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 16px;
  padding: 24px;
  display: flex;
  align-items: center;
  gap: 16px;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-primary-dark));
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.stat-card:hover::before {
  transform: scaleX(1);
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.open-stat::before {
  background: linear-gradient(90deg, var(--color-warning), #e6b400);
}

.progress-stat::before {
  background: linear-gradient(90deg, var(--color-info), #1e6fa8);
}

.resolved-stat::before {
  background: linear-gradient(90deg, var(--color-success), #229653);
}

.trend-stat::before {
  background: linear-gradient(90deg, var(--color-primary), var(--color-primary-dark));
}

.stat-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.open-stat .stat-icon {
  background: var(--color-warning-light);
  color: var(--color-warning);
}

.progress-stat .stat-icon {
  background: var(--color-info-light);
  color: var(--color-info);
}

.resolved-stat .stat-icon {
  background: var(--color-success-light);
  color: var(--color-success);
}

.trend-stat .stat-icon {
  background: var(--color-primary-light);
  color: var(--color-primary);
}

.stat-content {
  flex: 1;
}

.stat-value {
  font-size: 28px;
  font-weight: 800;
  color: var(--color-text-primary);
  line-height: 1;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 14px;
  color: var(--color-text-secondary);
  font-weight: 600;
  margin-bottom: 2px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-trend {
  font-size: 12px;
  color: var(--color-text-tertiary);
}

/* Reports Section */
.reports-section {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 20px;
  padding: 24px;
  box-shadow: var(--shadow-sm);
}

.section-header {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--color-border-light);
}

.section-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
  margin-bottom: 8px;
}

.section-title h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0;
}

.section-filters {
  display: flex;
  gap: 16px;
  align-items: center;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-group label {
  font-size: 13px;
  color: var(--color-text-secondary);
  font-weight: 600;
}

.filter-select {
  padding: 8px 12px;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  background: var(--color-surface);
  color: var(--color-text-primary);
  font-size: 13px;
  cursor: pointer;
}

.section-header p {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
}

/* Reports Grid */
.reports-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
  gap: 20px;
}

.report-card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 16px;
  padding: 20px;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
}

.report-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  transition: width 0.3s ease;
}

.report-card[data-status="open"]::before {
  background: var(--color-warning);
}

.report-card[data-status="in_progress"]::before,
.report-card[data-status="in progress"]::before {
  background: var(--color-info);
}

.report-card[data-status="resolved"]::before {
  background: var(--color-success);
}

.report-card:hover::before {
  width: 6px;
}

.report-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.report-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 16px;
}

.report-meta {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.report-date {
  font-size: 13px;
  color: var(--color-text-tertiary);
  font-weight: 500;
}

.report-id {
  font-size: 11px;
  color: var(--color-text-tertiary);
  font-weight: 600;
}

.report-type .type-badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 4px;
}

.item-type {
  background: var(--color-warning-light);
  color: var(--color-warning);
}

.request-type {
  background: var(--color-primary-light);
  color: var(--color-primary);
}

.other-type {
  background: var(--color-info-light);
  color: var(--color-info);
}

.report-content {
  margin-bottom: 20px;
}

.report-title {
  font-size: 16px;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 8px 0;
  line-height: 1.4;
}

.report-description {
  font-size: 14px;
  color: var(--color-text-secondary);
  line-height: 1.5;
  margin: 0 0 16px 0;
}

.report-details {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.detail-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.detail-label {
  font-size: 12px;
  color: var(--color-text-tertiary);
  font-weight: 600;
  min-width: 80px;
}

.detail-value {
  font-size: 13px;
  color: var(--color-text-primary);
  font-weight: 500;
}

.report-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.status-indicator {
  flex: 1;
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
}

.status-badge.open {
  background: var(--color-warning-light);
  color: var(--color-warning);
}

.status-badge.progress {
  background: var(--color-info-light);
  color: var(--color-info);
}

.status-badge.resolved {
  background: var(--color-success-light);
  color: var(--color-success);
}

.report-actions {
  display: flex;
  gap: 8px;
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.action-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.progress-btn {
  background: var(--color-info);
  color: white;
}

.progress-btn:hover:not(:disabled) {
  background: #1e6fa8;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(47, 58, 70, 0.3);
}

.resolve-btn {
  background: var(--color-success);
  color: white;
}

.resolve-btn:hover:not(:disabled) {
  background: #229653;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
}

.view-btn {
  background: var(--color-primary);
  color: white;
}

.view-btn:hover:not(:disabled) {
  background: var(--color-primary-dark);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(123, 30, 30, 0.3);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
}

.empty-icon {
  margin-bottom: 20px;
  opacity: 0.5;
}

.empty-icon svg {
  color: var(--color-text-tertiary);
}

.empty-state h3 {
  font-size: 20px;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 8px 0;
}

.empty-state p {
  font-size: 15px;
  color: var(--color-text-secondary);
  margin: 0;
  max-width: 400px;
  margin: 0 auto;
}

/* Notifications */
.notification {
  position: fixed;
  top: 100px;
  right: 24px;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 12px;
  padding: 16px 20px;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: 12px;
  transform: translateX(400px);
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 1000;
  max-width: 400px;
}

.notification.show {
  transform: translateX(0);
  opacity: 1;
}

.notification.success {
  border-left: 4px solid var(--color-success);
}

.notification.error {
  border-left: 4px solid var(--color-error);
}

.notification.info {
  border-left: 4px solid var(--color-primary);
}

.notification span {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
}

.close-notification {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: var(--color-text-tertiary);
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-notification:hover {
  color: var(--color-text-primary);
}

/* Modal Styles */
.modal.hidden { display: none; }
.modal { 
  position: fixed; 
  inset: 0; 
  z-index: 1200; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
}

.modal-backdrop { 
  position: absolute; 
  inset: 0; 
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
}

.modal-panel { 
  position: relative; 
  background: var(--color-surface); 
  border-radius: 20px; 
  width: min(600px, 90%); 
  max-height: 80vh; 
  overflow: auto; 
  padding: 24px; 
  z-index: 2; 
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--color-border);
}

.modal-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--color-border-light);
}

.modal-header h3 {
  font-size: 20px;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0;
}

.modal-close { 
  background: none; 
  border: none; 
  font-size: 24px; 
  cursor: pointer; 
  color: var(--color-text-tertiary);
  padding: 4px;
  border-radius: 6px;
}

.modal-close:hover {
  background: var(--color-background);
  color: var(--color-text-primary);
}

.modal-footer {
  margin-top: 24px;
  text-align: right;
  padding-top: 16px;
  border-top: 1px solid var(--color-border-light);
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-secondary {
  background: var(--color-background);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
}

.btn-secondary:hover {
  background: var(--color-border);
}

/* Animations */
@keyframes pulseSuccess {
  0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
  100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.loading-spinner {
  animation: spin 1s linear infinite;
}

/* Responsive Design */
@media (max-width: 768px) {
  .reports-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
  
  .reports-stats-grid {
    grid-template-columns: 1fr;
  }
  
  .reports-grid {
    grid-template-columns: 1fr;
  }
  
  .section-title {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
  
  .section-filters {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .report-footer {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }
  
  .report-actions {
    justify-content: stretch;
  }
  
  .action-btn {
    flex: 1;
    justify-content: center;
  }
}

@media (max-width: 480px) {
  .reports-container {
    padding: 0 16px;
  }
  
  .stat-card {
    padding: 20px;
  }
  
  .modal-panel {
    width: 95%;
    padding: 16px;
  }
}
</style>
{% endblock %}