<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Admin Â· ShareHub{% endblock %}</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/admin_shared.css' %}">
  <link rel="stylesheet" href="{% static 'css/header.css' %}?v=3">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  {% block head_extra %}{% endblock %}
</head>

<body data-color-scheme="light">

  <!-- Admin Header - Using same structure as user header -->
  <nav class="navbar">
    <nav class="navbar admin-nav">
      <div class="nav-container">
        <div class="nav-left">
          <a href="{% url 'admin_dashboard' %}" class="logo">
            <div class="logo-wrapper">
              <i class="fas fa-hands-helping logo-icon"></i>
            </div>
            <span class="logo-text">
              <span class="share-text">Share</span>
              <span class="hub-text">Hub</span>
            </span>
          </a>
        </div>

        <div class="nav-center">
          <a href="{% url 'admin_dashboard' %}"
            class="nav-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
            <i class="fas fa-home nav-icon"></i>
            <span class="nav-text">Home</span>
          </a>
          <a href="{% url 'approve_requests' %}"
            class="nav-link {% if request.resolver_match.url_name == 'approve_requests' %}active{% endif %}">
            <i class="fas fa-check-circle nav-icon"></i>
            <span class="nav-text">Approve Requests</span>
          </a>
          <a href="{% url 'manage_users' %}"
            class="nav-link {% if request.resolver_match.url_name == 'manage_users' %}active{% endif %}">
            <i class="fas fa-user-cog nav-icon"></i>
            <span class="nav-text">Manage Users</span>
          </a>
          <a href="{% url 'admin_reports' %}"
            class="nav-link {% if request.resolver_match.url_name == 'admin_reports' %}active{% endif %}">
            <i class="fas fa-chart-bar nav-icon"></i>
            <span class="nav-text">View Reports</span>
          </a>
        </div>

        <div class="nav-right">
          <div class="profile-dropdown">
            <button class="profile-trigger" type="button" id="profileTrigger">
              <div class="profile-avatar">
                <i class="fas fa-user-shield"></i>
              </div>
            </button>

            <div class="profile-menu" id="profileMenu">
              <div class="profile-info">
                <div class="profile-name">
                  Administrator
                </div>
                <div class="profile-email">admin@sharehub.edu</div>
              </div>

              <div class="profile-menu-divider"></div>

              <form action="{% url 'logout' %}" method="POST" style="margin: 0;">
                {% csrf_token %}
                <button type="submit" class="profile-menu-item logout">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Logout</span>
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </nav>

  <!-- Overlay for dropdowns -->
  <div id="profileOverlay" class="notification-overlay" aria-hidden="true"></div>

  </div>

  <main class="admin-main">
    {% block content %}{% endblock %}
  </main>

  <script>
    window.APP = window.APP || {};
    window.APP.CSRF_TOKEN = "{{ csrf_token }}";
    window.APP.URLS = {
      approveRequests: "{% url 'approve_requests' %}",
      manageUsers: "{% url 'manage_users' %}",
      viewReports: "{% url 'admin_reports' %}",
      dashboard: "{% url 'admin_dashboard' %}"
    };
  </script>

  <script>
    // Profile dropdown functionality
    document.addEventListener('DOMContentLoaded', function () {
      const profileTrigger = document.getElementById('profileTrigger');
      const profileDropdown = document.querySelector('.profile-dropdown');
      const profileMenu = document.getElementById('profileMenu');
      const profileOverlay = document.getElementById('profileOverlay');

      function openProfile() {
        profileDropdown.classList.add('active');
        profileOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      }

      function closeProfile() {
        profileDropdown.classList.remove('active');
        profileOverlay.classList.remove('active');
        document.body.style.overflow = '';
      }

      if (profileTrigger) {
        profileTrigger.addEventListener('click', function (e) {
          e.stopPropagation();
          if (profileDropdown.classList.contains('active')) {
            closeProfile();
          } else {
            openProfile();
          }
        });
      }

      profileOverlay.addEventListener('click', closeProfile);

      document.addEventListener('click', function (e) {
        if (!profileDropdown.contains(e.target) && !profileTrigger.contains(e.target)) {
          closeProfile();
        }
      });

      // Position profile menu correctly
      const profileTriggerBtn = document.getElementById('profileTrigger');
      const profileMenuEl = document.getElementById('profileMenu');

      function positionProfileMenu() {
        if (!profileTriggerBtn || !profileMenuEl) return;

        profileMenuEl.style.left = '';
        profileMenuEl.style.right = '';
        profileMenuEl.style.maxWidth = '';

        const menuRect = profileMenuEl.getBoundingClientRect();
        const triggerRect = profileTriggerBtn.getBoundingClientRect();
        const viewportWidth = document.documentElement.clientWidth;

        if (menuRect.right > viewportWidth - 8) {
          const leftPos = Math.max(8, triggerRect.right - menuRect.width);
          profileMenuEl.style.left = `${leftPos}px`;
          profileMenuEl.style.right = 'auto';
        } else {
          profileMenuEl.style.right = '0';
          profileMenuEl.style.left = 'auto';
        }

        if (menuRect.width > viewportWidth - 24) {
          profileMenuEl.style.maxWidth = `${viewportWidth - 24}px`;
          const newRect = profileMenuEl.getBoundingClientRect();
          if (newRect.right > viewportWidth - 8) {
            profileMenuEl.style.left = `${Math.max(8, triggerRect.right - newRect.width)}px`;
            profileMenuEl.style.right = 'auto';
          }
        }
      }

      profileTriggerBtn?.addEventListener('click', function () {
        setTimeout(positionProfileMenu, 50);
      });

      window.addEventListener('resize', positionProfileMenu);
      window.addEventListener('orientationchange', positionProfileMenu);
      window.addEventListener('scroll', positionProfileMenu, true);

      // Notification functionality (optional)
      const notificationBtn = document.querySelector('.notification-btn');
      const notificationPopup = document.getElementById('notificationPopup');
      const notificationOverlay = document.getElementById('notificationOverlay');
      const closePopupBtn = document.getElementById('closePopup');
      const markReadBtn = document.getElementById('markAllReadBtn');

      function openNotifications() {
        notificationPopup.classList.add('active');
        notificationOverlay.classList.add('active');
        notificationBtn.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      }

      function closeNotifications() {
        notificationPopup.classList.remove('active');
        notificationOverlay.classList.remove('active');
        notificationBtn.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      }

      if (notificationBtn) {
        notificationBtn.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();

          if (notificationPopup.classList.contains('active')) {
            closeNotifications();
          } else {
            openNotifications();
          }
        }, true);
      }

      if (closePopupBtn) {
        closePopupBtn.addEventListener('click', closeNotifications);
      }

      notificationOverlay.addEventListener('click', closeNotifications);

      if (markReadBtn) {
        markReadBtn.addEventListener('click', function () {
          const unreadItems = document.querySelectorAll('.notification-item.unread');
          unreadItems.forEach(item => {
            item.classList.remove('unread');
          });

          const badge = document.getElementById('notificationBadge');
          if (badge) {
            badge.style.display = 'none';
          }
        });
      }

      // Scroll effect for navbar
      let lastScrollTop = 0;
      const navbar = document.querySelector('.navbar');

      window.addEventListener('scroll', function () {
        let scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        if (scrollTop > 50) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }

        lastScrollTop = scrollTop;
      });

      // Close on escape key
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
          closeProfile();
          closeNotifications();
        }
      });
    });
  </script>

  {% block scripts %}{% endblock %}
</body>

</html>