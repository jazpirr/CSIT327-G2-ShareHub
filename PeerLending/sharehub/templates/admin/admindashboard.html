{% extends "admin/admin_base.html" %}
{% load static %}
{% block title %}Admin Dashboard Â· ShareHub{% endblock %}

{% block head_extra %}
<!-- Include dashboard CSS only for dashboard content -->
<link rel="stylesheet" href="{% static 'css/admindashboard.css' %}" />
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- Page Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="page-title">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" class="title-icon">
          <path d="M12 2l7 3v5c0 5-3.58 9.74-7 11-3.42-1.26-7-6-7-11V5l7-3z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
        </svg>
        Admin Dashboard
      </h1>
      <p class="page-subtitle">Comprehensive system management and monitoring</p>
    </div>
    <div class="header-actions">
      <div class="last-updated">
        <span class="update-indicator"></span>
        Updated just now
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card users-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" fill="currentColor"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ total_users|default:"245" }}</div>
        <div class="stat-label">Total Users</div>
        <div class="stat-meta">
          <span class="growth positive">{{ users_growth|default:"+12%" }}</span>
          <span class="count">{{ active_users|default:"198 active" }}</span>
        </div>
      </div>
    </div>

    <div class="stat-card items-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ total_items|default:"387" }}</div>
        <div class="stat-label">Total Items</div>
        <div class="stat-meta">
          <span class="count">{{ available_items|default:"302 available" }}</span>
        </div>
      </div>
    </div>

    <div class="stat-card requests-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ active_requests|default:"45" }}</div>
        <div class="stat-label">Active Requests</div>
        <div class="stat-meta">
          <span class="count pending">{{ pending_requests|default:"12 pending" }}</span>
        </div>
      </div>
    </div>

    <div class="stat-card issues-stat">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ issues_count|default:"11" }}</div>
        <div class="stat-label">Issues</div>
        <div class="stat-meta">
          <span class="count overdue">{{ overdue|default:"8 overdue, 3 flagged" }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="chart-card">
      <div class="chart-header">
        <h3>Borrowing Overview</h3>
        <p>Total items lent vs currently borrowed</p>
      </div>
      <div class="chart-container">
        <canvas id="borrowingChart" aria-label="Borrowing Overview chart"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <h3>Return Performance</h3>
        <p>Status of returned items</p>
      </div>
      <div class="chart-container">
        <canvas id="returnChart" aria-label="Return Performance chart"></canvas>
      </div>
    </div>
  </div>

  <!-- Borrowed Items Table -->
  <div class="table-section">
    <div class="table-header">
      <div class="table-title">
        <h3>Items Currently Borrowed</h3>
        <span class="item-count">{{ current_borrowed_count|default:"6" }} Items</span>
      </div>
      <p>Track all active borrowing transactions</p>
    </div>

    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Item Owner</th>
            <th>Borrower</th>
            <th>Return Due Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for row in borrowed_items %}
          <tr class="table-row">
            <td class="item-name">{{ row.item_name }}</td>
            <td class="item-owner">{{ row.item_owner }}</td>
            <td class="borrower">{{ row.borrower }}</td>
            <td class="due-date">
              <div class="date-info">
                <span class="date">{{ row.due_date }}</span>
                {% if row.overdue_text %}
                <span class="overdue-indicator">{{ row.overdue_text }}</span>
                {% elif row.remaining_text %}
                <span class="remaining-indicator">{{ row.remaining_text }}</span>
                {% endif %}
              </div>
            </td>
            <td>
              <span class="status-tag {{ row.status_class }}">{{ row.status_label }}</span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="empty-state">
              <div class="empty-content">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                  <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
                </svg>
                <p>No items currently borrowed</p>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const BORROWING_CHART = (function(){
    try { return JSON.parse('{{ borrowing_chart|safe|escapejs }}'); } catch(e){ return { labels: ['Total Lent','Currently Borrowed'], values: [0,0] }; }
  })();

  const RETURN_CHART = (function(){
    try { return JSON.parse('{{ return_chart|safe|escapejs }}'); } catch(e){ return { labels: ['On Time','Late','Missing/Lost'], values: [100,0,0] }; }
  })();

  const BORROWED_ITEMS = (function(){
    try { return JSON.parse('{{ borrowed_items_json|safe|escapejs }}'); } catch(e){ return []; }
  })();

  const ADMIN_URLS = {
    overview: "{% url 'admin_dashboard' %}",
    approveRequests: "{% url 'approve_requests' %}",
    manageUsers: "{% url 'manage_users' %}",
    viewReports: "{% url 'admin_reports' %}"
  };
</script>
<script src="{% static 'js/admindashboard.js' %}"></script>
{% endblock %}